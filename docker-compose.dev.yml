version: '3'
services:
  banking:
    image: 'banking:latest'
    build: .
    tty: true

#  core:
#    image: 'sgb:latest'
#    build:
#      context: .
#      dockerfile: Dockerfile
#    container_name: core
#    tty: true
#    volumes:
#      - ./core:/core
#    environment:
#      PYTHONWARNINGS: 'ignore'
#    restart: unless-stopped

  iam-service:
    image: 'banking:latest'
    tty: true
    container_name: banking-iam-service
    volumes:
      - ./iam:/iam
    environment:
      PYTHONWARNINGS: 'ignore'
    restart: always
    working_dir: /iam
    ports:
      - '50051:50051'

  iam:
    image: 'banking:latest'
    tty: true
    container_name: banking-iam
    depends_on:
      - iam-service
    volumes:
      - ./iam:/iam
    environment:
      PYTHONWARNINGS: 'ignore'
    restart: always
    command: >
      bash -c "python manage.py makemigrations &&
               python manage.py migrate &&
               python manage.py runserver 0.0.0.0:8000"
    working_dir: /iam
    ports:
      - '8000:8000'

  sgb:
    image: 'banking:latest'
    tty: true
    container_name: banking-sgb
    depends_on:
      - iam-service
    volumes:
      - ./sgb:/sgb
    environment:
      PYTHONWARNINGS: 'ignore'
    command: >
      bash -c "python manage.py makemigrations &&
               python manage.py migrate &&
               python manage.py runserver 0.0.0.0:8001"
    restart: always
    working_dir: /sgb
    ports:
      - '8001:8001'
